import { authorizedFetch } from "@uoisfrontend/shared"
import { ItemActions } from "@uoisfrontend/shared/src/Store"

export const ProgramQueryJSON = (id) => ({
  query: `query($id: ID!) {
      result: programById(id: $id) {
        __typename
        id
        name
        lastchange
        type {
          id
          name
          level { id name }
          form { id name }
          language { id name }
          title { id name }
        }
        subjects {
          __typename
          id
          lastchange
          name
          semesters {
            id
            order
          }          
        }
      }
    }
    `,
  variables: {id: id}
})

export const ProgramQuery = (id) =>
    authorizedFetch('/gql', {
        body: JSON.stringify(ProgramQueryJSON(id)),
    })

export const ProgramFetchAsyncAction = ({id}) => (dispatch, getState) => {
    return (
        ProgramQuery(id)
        .then(response => response.json())
        .then(
            json => {
                const result = json?.data?.result
                if (result) {
                    const action = ItemActions.item_update(result)
                    dispatch(action)
                }
                return json
            }
        )
    )
}
